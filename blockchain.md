
# 암호화폐 개념

암호화폐를 이해 하려면 첫째 화폐가 무엇인지 알아야한다. 그리고 암호화 기술에 대해 알아야 한다.

## 화폐
암호화폐는 화폐가 무엇인지에 대해 생각하도록한다. 왜냐하면 암호화폐를 알려면 화폐의 개념을 알아야하기 때문이다. 첫번째 화폐는 극단적으로 단순화 하면 장부에 기록된 숫자이다. 이것은 누가 누구에게 얼마를 빌려 줬는지, 또는 얼마를 소유했는 가에 대한 기록이다.  은행에는 은행이 소유한 서버가 있고 이 서버에 은행 계좌를 소유한 사람의 자산의 입출력 내역이 기록되어 있다. 그리고 최종 잔액이 기록되어 있다. 은행 계좌 번호와 사용자 계정 사이의 관계가 DB 에 기록되어 있다. 그리고 계좌의 거래 내역과 잔액이 기록되어 있다. 비슷하게 법원등기소에 등록 자산에 대한 소유자 기록과 소유뮬에 대한 변동 이력(기록)이 등록되어 있다.

## 장부
비트코인도 은행과 등기소 같은 저장소가 필요하다. 은행과 등기소 역할을 비트코인 네크워크가 담당한다.  아주 극단적으로 간단히 말해서 비트코인은 비트코인 네트워크에서 발행한 토큰(화폐)이다. 비트코인 네트워크 상에 전자 장부가 존재하고  이 장부를 복사한 사본이 여러개 존재하도록 네트워크를 구성한다. 그리고 네트워크 상의 계좌(지갑)들의 거래 내역을  전자 장부에 기록하고 일련의 과정을 통해 거래내역이(장부가) 복사된다. 즉 비트코인 네트워크는 은행이나 법원 등기소가 하는 역할을 대신한다. 

## 거래기록
비트코인 네트워크 장부에도 은행과 같이 거래 내역이 기록된다.  은행의 계좌에 해당하는 것이 지갑주소이다. 즉 비트코인 네트워크에서 거래 내역을 기록할 수 있다. 이론적으로는  그것이 비트코인 거래내역일 수 있고 다른 어떤 거래내역일 수도 있다. 80바이트의 문자열을 기록할 수 있다.
비트코인을 특정 지갑에서 다른 지갑으로 보내려면 보내는 쪽에서 거래(트랜젝션)을 생성한다. 여기서 부터는 암호화 지식이 필요하다. 이 거래(트랜젝션)에는 보내는 쪽과 받는 쪽 그리고 거래 금액 시간 등과 같은 정보가 기록되고 보내는 지갑의 프라이빗 키를 사용하여 서명을 한다. 이 기록이 검증을 통해 장부에 기록되고 네트워크에 전파되게 된다. 거래의 서명과정과 검증 과정에 비대칭 암호화 알고리즘이 사용된다.


## 지갑주소
 은행의 경우 거래의 대상 식별은 계좌 번호이고 소유자 정보를 DB에 저장된다. 그런데 비트코인 네크워크 상의 거래의 경우 계좌 번호에 해당하는 것이 지갑주소이다. 지갑주소는 비대칭 암호와 알고리즘으로 생성된 개인키와(프라이빗키)와 공개키(퍼블릭키) 중 퍼플릭키로 부터 생성된다. 즉 퍼블릭키를 알면 특정 해시 알고리즘을 사용하여 지갑 주소를 생성할 수 있다. 그리고 퍼블릭키의 소유권은 프라이빗 키로 증명할 수 있다. 그래서 프라이빗 키를 소유한 사람이 결국 계좌(지갑주소)의 소유자임을 증명할 수 있다. 퍼블릭키는 공개되어도 상관없지만 프라이빗키는 공개 되어서는 안된다. 누군가 다른 사람의 프라이빗키를 알게되면 계좌의 소유권을 가진 것과 동일하다. 이 프라이빗 키를 저장하기 위해 암호화폐 지갑이 사용된다. 즉 비트코인은 지갑에 저장되는 것이 아니라 장부상에 기록되어 있고 장부상의 지갑주소라 불리는 일종의 계좌에 대한 소유권을 나타내는 프라이빗 키를 저장하는 것이다. 하드웨어 지갑은 오프라인으로 하드웨어 장치에 프라이빗 키를 저장하고 이 프라이빗 키를 생성하는 시드를 니모닉으로 생성한다. 이 니모닉(영단어)를 기억하면 하드웨어 지갑에서 다시 프라이빗 키를 복원할 수 있다.(보통 12개 24개 단어로 구성됨)

## 블록체인
비트코인 블록체인에서 블록을 생성할 때, 블록의 해시를 계산하는 과정에는 이전 블록의 해시값이 포함된다. 즉 블록과 블록이 해시값으로 체인을 이루게 된다. 보통 블록의 무결성을 블록의 해시에 서명을 하는 대신, 비트코인 블록체인은 작업 증명(Proof of Work, PoW) 메커니즘을 사용하여 블록을 검증하고 네트워크의 합의를 얻는다. 


## 해시와 작업 증명
해시란 데이터 블록에 대한요약(데이터 블록보다 길이가 아주 짧다)으로, 특정 알고리즘을 사용하여 블록 값이 바뀌면 해시 값도  바뀌도록 생성한다. 아주 작은 변경을 하더라도 완전히 다른 해시를 생성하기 때문에, 변경을 쉽게 알 수 있다.  거래가 생성되면 검증을 통해 네트워크에 전파되고 이를 묶어 블록으로 생성하는데 블록을 생성하는 작업자를 채굴자라 부른다. 

블록생성자가 블록을 생성할 때 블록 헤더 정보를 포함하여 해시값을 계산하는데 특정 조건을 만족해야하는데 이를 만족하는 블록 만을 유효한 블록으로 인정한다.  이 유효한 블록을 생성하기위한 작업을 작업 증명이라 한다. 즉 블록 생성자가  블록의 해시를 생성할 때  논스(Nonce)라는 임이의 값을 포함하여 해시 값을 생성하는데 특정 난이도 조건을 만족하도록  논스 값을 순차적으로 변경해 가면 반복해서 해시를 생성한다. 조건을 만족하는 해시 생성에 시간이 많이 소유되기 때문에, 아무나 블록을 생성할 수 있지만 유효한 블록으로 인정 받지는 못한다. 가장 먼저 조건을 만족하는 해시를 생성한 블록 생성자에게 보상이 주어지는 데 이것이 비트코인 이다. 이 과정을 비트코인 채굴이라 부른다.


## 잔액계산
지갑주소의 잔액 계산은 지갑 소프트웨어가 담당한다. 비트코인 지갑의 최종 자산, 즉 밸런스를 알아내기 위해서는 해당 지갑 주소에 연관된 모든 트랜잭션을 분석하고, 입력은 있지만 출력은 없는 UTXO(미사용 트랜잭션 출력, Unspent Transaction Outputs)를 합산해야 한다.  시간이 많이 걸리는 작업이기 때문에 이를 위해 비트코인 네트워크는 지갑주소의 트랜젝션 인덱스와 UTXO 데이터베이스 같은 인프라를 제공한다.


### 트랜젝션 서명과 검증

서명란 비대칭 암호화 알고리즘의 특성을 사용하여 해시를 프라이빗 키로 암호화 하는 것을 의미한다. 프라이빗 키로 암호화 한 데이터(블록)은 퍼블릭 키로만 복원할 수 있다. 반대로 퍼블릭키로 암호화한 데이터를 프라이빗키로 복원 할 수 있다.  퍼블릭키로는 암호화된 해시를 풀수는 있지만 다시 암호화 할 수 는 없다. ( 퍼블릭키로 해시를 암호화 하면 퍼블릭키로 풀수 없고 프라이빗 키로만 풀수 있음).  거래의 에는 잔액을 계산할 수 있는  UTXO(미사용 트랜잭션 출력, Unspent Transaction Outputs)에 대한 정보와 받는 지갑 주소 그리고 금액등 트랜잭션의 중요한 요소를 모아서 해시를 생성한 뒤   프라이빗 키를 사용해 서명을 한다.   그리고 트랜젝션, 서명, 그리고 공개 키를  비트코인 네트워크에 전송한다.

비트코인 네트워크는 보내는 쪽의 지갑 주소와 해당 주소의 잔액을 확인하여 트랜젝션이 유효한지 검증하고 해시를 계산한뒤 공개키로 서명된 해시를 복원하여 해시 값이 동일한지 확인 한다. 퍼블릭키로 부터 지갑주소를생성하여 해당 지갑주소와 일치하는지 확인한다.(지갑주소의 소유자가 서명 했음을 확인)

## 비트코인 네트워크
비트코인 지갑 소프트웨어나 비트코인 클라이언트를 통새 비트코인 네크워크에 연결할 수 있다. 네트워크 정보는 하드코딩된 피어와 DNS 시드를 통해 초기 피어 정보를 얻는다. 초기 피어와 연결된 후, 더 많은 피어와 연결하여 네트워크에 참여한다. IP 주소와 포트를 열어 다른 노드들과의 연결을 활성화하고, 필요시 DNS 시드나 커뮤니티 포럼을 통해 정보를 공개할 수 있다.



