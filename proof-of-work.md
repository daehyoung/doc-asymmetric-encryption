
# 작업 증명(Proof of Work, PoW)

비트코인 블록체인에서 블록을 생성할 때, 블록의 해시를 계산하는 과정에는 이전 블록의 해시값이 포함됩니다. 그러나 블록의 해시에 서명을 하는 과정은 없습니다. 대신, 비트코인 블록체인은 작업 증명(Proof of Work, PoW) 메커니즘을 사용하여 블록을 검증하고 네트워크의 합의를 얻습니다. 아래는 이 과정에 대한 자세한 설명입니다.

### 블록 생성 과정

1. **블록 헤더 구성**:
   - **이전 블록의 해시(Prev Block Hash)**: 현재 생성 중인 블록의 헤더에는 이전 블록의 해시가 포함됩니다. 이를 통해 블록체인이 연결된 상태를 유지합니다.
   - **머클 루트(Merkle Root)**: 현재 블록에 포함된 모든 트랜잭션의 해시를 머클 트리로 구성한 후, 머클 루트를 계산하여 블록 헤더에 포함합니다.
   - **타임스탬프(Timestamp)**: 블록이 생성된 시점을 나타냅니다.
   - **난이도 목표(Target Difficulty)**: 현재 블록을 채굴하기 위한 난이도 수준을 나타냅니다.
   - **논스(Nonce)**: 블록의 해시값을 난이도 목표에 맞추기 위해 변동되는 값입니다.

2. **작업 증명(Proof of Work)**:
   - **해시 계산**: 채굴자는 위의 블록 헤더 정보를 포함하여 해시값을 계산합니다. 이 해시값은 SHA-256 해시 함수로 계산됩니다.
   - **해시값 비교**: 계산된 해시값이 난이도 목표보다 작아야 합니다. 이를 위해 논스 값을 반복적으로 변경하며 올바른 해시값을 찾습니다.

3. **블록 채굴 및 전파**:
   - **블록 채굴**: 채굴자는 올바른 해시값을 찾으면 블록이 채굴되었다고 말합니다.
   - **블록 전파**: 채굴된 블록은 네트워크에 전파되고, 다른 노드들은 이 블록을 검증합니다.

### 서명 과정과의 차이점

- **트랜잭션 서명**: 블록 자체에는 서명 과정이 없지만, 블록에 포함된 각 트랜잭션은 개별적으로 서명됩니다. 트랜잭션 서명은 발신자가 자신의 프라이빗 키를 사용하여 트랜잭션에 서명함으로써, 자신이 해당 비트코인의 소유자임을 증명하는 과정입니다.
- **블록 검증**: 채굴된 블록은 서명되지 않지만, PoW를 통해 검증됩니다. 다른 노드들은 새 블록이 올바르게 채굴되었는지, 즉 난이도 목표를 만족하는 해시값을 가지고 있는지를 확인합니다.

### 요약

비트코인 블록체인에서는 각 블록의 해시를 계산할 때 이전 블록의 해시를 포함하여 연결성을 유지합니다. 블록 자체에 서명을 하는 과정은 없으며, 대신 PoW 메커니즘을 사용하여 블록을 검증합니다. 개별 트랜잭션은 발신자의 프라이빗 키로 서명되지만, 블록은 PoW를 통해 네트워크의 합의를 얻습니다.



# 비트코인 트랜잭션의 서명

비트코인 트랜잭션의 서명은 발신자가 자신의 비트코인을 보내기 위해 트랜잭션에 디지털 서명을 추가하는 과정입니다. 이 서명은 발신자가 해당 트랜잭션의 유효성을 증명하고, 비트코인을 전송할 권한이 있음을 보장합니다. 트랜잭션 서명 과정은 다음과 같이 이루어집니다:

### 1. 트랜잭션 생성

트랜잭션을 생성할 때 다음과 같은 필수 정보가 포함됩니다:
- **입력(Input)**: 이전 트랜잭션의 UTXO를 참조합니다. 여기에는 이전 트랜잭션의 해시와 출력 인덱스가 포함됩니다.
- **출력(Output)**: 비트코인을 받는 주소와 보낼 금액이 포함됩니다.

### 2. 트랜잭션 해시 생성

트랜잭션의 중요한 요소를 모아서 해시를 생성합니다. 이 해시를 트랜잭션 ID라고 부르며, SHA-256 해시 함수로 계산됩니다. 서명을 위해 해시가 한 번 더 처리됩니다(SHA-256을 두 번 적용).

### 3. 디지털 서명 생성

발신자는 자신의 프라이빗 키를 사용하여 트랜잭션 해시에 서명합니다. 서명 과정은 다음과 같습니다:
1. **트랜잭션 해시**: 발신자가 전송하고자 하는 트랜잭션의 해시를 생성합니다.
2. **서명 알고리즘**: ECDSA(타원곡선 디지털 서명 알고리즘)를 사용하여 발신자의 프라이빗 키와 트랜잭션 해시로 서명을 생성합니다. 서명은 두 개의 값 (r, s)로 구성됩니다.

### 4. 트랜잭션에 서명 추가

서명된 트랜잭션은 발신자의 서명과 공개 키를 포함합니다. 공개 키는 발신자가 서명을 생성할 때 사용된 프라이빗 키와 짝을 이루며, 네트워크에서 서명을 검증하는 데 사용됩니다.

### 5. 트랜잭션 전파 및 검증

서명된 트랜잭션은 네트워크에 전파되며, 각 노드는 다음 과정을 통해 서명의 유효성을 검증합니다:
1. **공개 키 검증**: 발신자가 제공한 공개 키를 사용하여 서명을 검증합니다. 공개 키는 트랜잭션 해시와 서명이 일치하는지 확인하는 데 사용됩니다.
2. **UTXO 검증**: 트랜잭션 입력이 참조하는 UTXO가 유효하며, 현재 사용되지 않은 상태인지 확인합니다.

### 트랜잭션 예시

가령, Alice가 Bob에게 1 BTC를 보내고자 할 때 다음과 같은 과정이 이루어집니다:

1. **트랜잭션 생성**: Alice는 이전에 받은 트랜잭션의 UTXO를 입력으로 사용하여 새로운 트랜잭션을 생성하고, 1 BTC를 Bob의 주소로 보냅니다.
2. **트랜잭션 해시**: Alice의 지갑 소프트웨어가 트랜잭션 해시를 생성합니다.
3. **디지털 서명**: Alice의 지갑 소프트웨어가 Alice의 프라이빗 키로 트랜잭션 해시에 서명합니다.
4. **트랜잭션 전파**: 서명된 트랜잭션이 네트워크에 전파됩니다.
5. **트랜잭션 검증**: 네트워크의 노드들은 Alice의 공개 키로 서명을 검증하고, 트랜잭션의 UTXO가 유효한지 확인합니다.

이 과정을 통해 Alice는 자신의 비트코인을 Bob에게 안전하게 보낼 수 있습니다. 각 단계에서 암호학적 서명과 해시 함수를 사용하여 트랜잭션의 무결성과 발신자의 권한을 보장합니다.


## 트랜잭션 생성 및 비트코인 네트워크에 전송
비트코인 지갑 소프트웨어를 통해 거래할 때, 서명된 트랜잭션 정보를 생성하고 이를 비트코인 네트워크에 전송하는 과정은 다음과 같습니다. 이 과정에서 서명된 거래 정보를 생성하는 방법과 서버에 전송하는 과정을 구체적으로 설명하겠습니다.

### 서명된 트랜잭션 정보 생성 과정

1. **트랜잭션 구성**:
   - **입력 (Input)**: 지갑 소프트웨어는 사용자의 비트코인 잔액을 확인하여 사용할 수 있는 UTXO(Unspent Transaction Outputs)를 선택합니다.
   - **출력 (Output)**: 사용자가 지정한 수신 주소와 송금할 금액을 포함합니다. 추가적으로 잔액이 남을 경우, 잔액을 반환할 주소(변경 주소)도 포함됩니다.

2. **트랜잭션 해시 생성**:
   - 지갑 소프트웨어는 트랜잭션의 핵심 요소(입력, 출력 등)를 사용하여 트랜잭션 해시를 생성합니다. 이 해시는 트랜잭션의 고유 식별자가 됩니다.

3. **디지털 서명 생성**:
   - 트랜잭션 해시를 사용하여, 사용자의 프라이빗 키로 디지털 서명을 생성합니다. 이 서명은 ECDSA(타원곡선 디지털 서명 알고리즘)를 사용합니다.
   - 생성된 서명은 트랜잭션과 함께 전송됩니다. 서명은 트랜잭션의 무결성을 보장하고, 서명을 검증하는데 사용될 발신자의 공개 키를 포함합니다.

4. **서명된 트랜잭션 생성**:
   - 서명된 트랜잭션은 서명, 입력, 출력 및 기타 필요한 메타데이터를 포함하는 데이터 구조입니다.
   - 이 서명된 트랜잭션은 지갑 소프트웨어에서 생성되어, 네트워크에 전송할 준비가 됩니다.

### 서명된 트랜잭션 정보 전송

1. **서명된 트랜잭션 정보 얻기**:
   - 지갑 소프트웨어는 위에서 생성한 서명된 트랜잭션을 사용합니다.
   - 서명된 트랜잭션은 JSON, 바이너리 등 특정 형식으로 표현됩니다.

2. **트랜잭션 브로드캐스트**:
   - 서명된 트랜잭션은 네트워크에 전송됩니다. 이를 위해 지갑 소프트웨어는 비트코인 풀 노드나 경량 노드와 통신합니다.
   - 서명된 트랜잭션을 비트코인 네트워크에 브로드캐스트하는 방법은 다음과 같습니다:
     - **풀 노드 연결**: 지갑 소프트웨어는 로컬 또는 원격 풀 노드에 직접 연결하여 트랜잭션을 전송합니다.
     - **SPV 노드 연결**: 경량 지갑의 경우, SPV(Simple Payment Verification) 방식을 사용하여 네트워크에 연결된 다른 노드를 통해 트랜잭션을 전송합니다.
     - **서버/API 사용**: 지갑 소프트웨어는 블록체인 탐색기 API(예: BlockCypher, Blockchain.info 등)를 사용하여 서명된 트랜잭션을 전송할 수도 있습니다.

3. **트랜잭션 검증 및 전파**:
   - 네트워크에 전송된 트랜잭션은 다른 노드들에 의해 검증됩니다. 트랜잭션의 서명과 UTXO의 유효성을 확인한 후, 트랜잭션을 블록에 포함시킵니다.
   - 검증된 트랜잭션은 다른 노드들에게도 전파되어 네트워크 전체에 알려집니다.

### 요약

- **트랜잭션 구성**: 입력, 출력 정보를 지갑 소프트웨어에서 선택 및 구성.
- **트랜잭션 해시 생성**: 트랜잭션의 핵심 요소를 해시하여 고유 식별자 생성.
- **디지털 서명 생성**: 사용자의 프라이빗 키로 트랜잭션 해시에 서명.
- **서명된 트랜잭션 생성**: 서명, 입력, 출력 및 메타데이터를 포함하는 데이터 구조.
- **트랜잭션 브로드캐스트**: 지갑 소프트웨어가 네트워크에 트랜잭션을 전송.
- **검증 및 전파**: 네트워크 노드들이 트랜잭션을 검증하고, 이를 블록에 포함시키고 전파.

이 과정을 통해 비트코인 트랜잭션이 안전하게 생성되고, 네트워크에 전송 및 검증됩니다.

