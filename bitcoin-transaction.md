# 비트코인 트랜젝션

## 거래소를 이용한 트랜잭션 시나리오

비트코인과 같은 암호화폐를 거래소에서 거래할 때, 특히 바이낸스와 같은 중앙화된 거래소(Centralized Exchange, CEX)를 이용할 때 거래 과정과 기록이 다음과 같은 방식으로 이루어집니다.

### 거래소 내부 기록
1. **거래소 계정 생성 및 입금**:
   - 사용자는 바이낸스 계정을 생성하고, 해당 계정에 미국 달러(USD) 또는 다른 법정 화폐를 입금합니다.
   - 이 단계에서의 입금은 거래소의 은행 계좌를 통해 이루어지며, 이 내용은 바이낸스의 내부 시스템에 기록됩니다.

2. **비트코인 구매 주문**:
   - 사용자가 비트코인을 구매하면, 바이낸스는 내부 장부에 사용자의 달러 잔고를 감소시키고, 해당하는 비트코인 잔고를 증가시킵니다.
   - 이 거래는 바이낸스의 중앙화된 데이터베이스에 기록됩니다. 여기에는 구매자의 ID, 거래 금액, 구매한 비트코인 수량 등이 포함됩니다.
   
3. **거래소 내 자산 이동**:
   - 사용자가 거래소 내에서 비트코인 구매/판매를 반복하는 경우, 이 모든 거래는 바이낸스의 내부 시스템에 기록됩니다.
   - 이 단계의 거래는 실제 블록체인 네트워크에 전파되지 않으며, 거래소 내부 데이터베이스에만 기록됩니다.

### 블록체인 기록
1. **비트코인 인출**:
   - 사용자가 바이낸스에서 자신의 개인 지갑으로 비트코인을 출금하기로 결정하면, 이 시점에 트랜잭션이 비트코인 블록체인에 기록됩니다.
   - 사용자는 바이낸스에서 인출 요청을 하고, 바이낸스는 해당 요청을 처리하여 사용자가 지정한 비트코인 주소로 비트코인을 전송합니다.
   - 이 트랜잭션은 비트코인 네트워크에 전파되고, 채굴자들에 의해 블록에 포함되어 블록체인에 기록됩니다.
   
2. **블록체인 트랜잭션 내용**:
   - 블록체인에 기록되는 트랜잭션에는 다음과 같은 정보가 포함됩니다:
     - 송금자 주소(바이낸스의 비트코인 주소)
     - 수신자 주소(사용자의 비트코인 주소)
     - 전송된 비트코인 수량
     - 트랜잭션 수수료
     - 트랜잭션 해시 (TxID)
   - 이러한 트랜잭션은 모두 공개적으로 확인할 수 있으며, 누구나 블록 탐색기를 통해 조회할 수 있습니다.

### 요약
- **거래소 내부 기록**: 사용자의 법정 화폐 입금, 비트코인 매수/매도, 계좌 잔고 변화 등의 정보가 바이낸스의 중앙화된 데이터베이스에 기록됩니다.
- **블록체인 기록**: 사용자가 비트코인을 인출할 때, 해당 트랜잭션이 비트코인 블록체인에 기록됩니다. 여기에는 송수신 주소, 전송된 비트코인 수량, 트랜잭션 수수료 등이 포함됩니다.

따라서, 거래소에서 비트코인을 거래할 때의 모든 과정이 블록체인에 기록되는 것은 아니며, 거래소 내부에서 이루어지는 대부분의 거래는 해당 거래소의 데이터베이스에만 기록됩니다. 오직 거래소에서 외부 지갑으로 비트코인을 인출할 때만 비트코인 블록체인에 기록됩니다.

 ## 블록체인 기록
 1. 비트코인 인출을 요청하면
 2. 사용자는 출금자 지갑주소
  출금자 지갑주소, 비트코인 수량, 수수료(보통 자동 입력됨)를 입력 한다.

 3. 거래소는 트랜잭션을 생성한다.
    송금자 지갑주소(바이낸스의 비트코인 주소)
    출금자 지갑주소(개인 비트코인 지갑 주소)
    비트코인 수량
    트랜잭션 해시
    트랜잭션 수수료
        
5. 송금자의 개인키(바이낸스 개인키)로 서명한다.
   비트코인 네트워크에 전송한다.
6. 비트코인 네트워크는 해당 트랜잭션을 검증하고 유효한 트랜잭션이면 블럭에 추가한다.
7. 거래소 화면에 전송중으로 표시한다.
8. 비트코인 네트워크는 우선순위에 따라 트랜잭션을 블록에 추가한다.
- 보통 1개의 블록을 생성하는데 약 10분 정도 소요된다. 빠르면 10분안에 첫번째 블록에 기록된다.
- 채굴자는 작업 증명(Proof of work)을 통해 블록이 유효한 블록임을 증명한다. - 블록 해시를 계산하는데, 난이도에 따라 블록 해시 값이 특정 패턴을 갖도록 하기 위해, 반복적으로 블럭 해시 + 논스 (순차적인 증가 값)로 해시를 계산한다. (해시 계산에 평균 10분 정도 걸리도록 알고리즘적으로 난이도가 자동 조정되도록 되어 있다.)
- 트랜잭션 수수료를 많이 지급하면 블록에 포함될 확률이 높아진다.
9. 트랜잭션이 블록에 포함되면 거래소 화면의 상태가 변경된다.
- 처음 블록에 기록되면 상태에 "1 Confirmations" 이라고 표시된다. 두 번째 블록이 생성되면 트랜잭션은 "2 Confirmations"를 받게 된다. 비트코인 네트워크에서는 일반적으로 6번의 확인을 받으면 트랜잭션이 완전히 안전한 것으로 간주된다.
- "6 Confirmations" 까지 약 1시간에서 1시간 30분 정도 소요된다.


    
    
